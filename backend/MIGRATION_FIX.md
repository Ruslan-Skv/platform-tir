# Решение проблемы с миграцией

## Проблема
Prisma обнаружил несоответствие между схемой базы данных и историей миграций. Это означает, что база была создана без использования миграций.

## Решение (БЕЗ потери данных)

### Вариант 1: Использовать `db push` (рекомендуется для разработки)

Этот метод синхронизирует схему без создания миграций:

```bash
cd backend
npx prisma db push
```

Эта команда:
- ✅ Применит изменения схемы к базе данных
- ✅ НЕ удалит существующие данные
- ✅ Добавит новую таблицу `product_components`
- ✅ Обновит таблицу `cart_items`

После этого сгенерируйте Prisma Client:
```bash
npx prisma generate
```

### Вариант 2: Создать baseline миграцию (для продакшена)

Если нужно сохранить историю миграций:

1. Сначала создайте baseline миграцию для текущего состояния:
```bash
cd backend
npx prisma migrate resolve --applied <имя_существующей_миграции>
```

2. Или создайте пустую миграцию для текущего состояния:
```bash
npx prisma migrate dev --create-only --name baseline
# Отредактируйте созданный SQL файл, оставив его пустым или с комментарием
npx prisma migrate resolve --applied baseline
```

3. Затем создайте миграцию для новых изменений:
```bash
npx prisma migrate dev --name add_product_components
```

## Рекомендация

Для разработки используйте **Вариант 1** (`prisma db push`), так как:
- Быстро и безопасно
- Не требует управления историей миграций
- Не удаляет данные

После применения выполните:
```bash
npx prisma generate
```

Затем перезапустите backend сервер.
