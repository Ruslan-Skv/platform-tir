#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸš€ Running frontend pre-commit checks..."

# 1. Ğ—Ğ°Ğ¿ÑƒÑĞº lint-staged Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ¸ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ staged Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²
# (Prettier, ESLint, Secretlint Ğ´Ğ»Ñ staged Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²)
echo "ğŸ” Running lint-staged on staged files..."
npx lint-staged || {
  echo "âŒ Lint-staged checks failed"
  exit 1
}

# 2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ‚Ğ¸Ğ¿Ğ¾Ğ² TypeScript (tsc --noEmit)
echo "ğŸ” Type checking (tsc --noEmit)..."
npm run type-check || {
  echo "âŒ TypeScript errors found"
  exit 1
}

# 3. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Prettier
echo "ğŸ” Checking formatting (Prettier)..."
npm run format:check || {
  echo "âŒ Formatting issues found. Run 'npm run format' to fix."
  exit 1
}

# 4. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ESLint
echo "ğŸ” Linting (ESLint)..."
npm run lint || {
  echo "âŒ ESLint errors found"
  exit 1
}

# 5. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° FSD-Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹
echo "ğŸ” Checking FSD architecture..."
npm run check-fsd || {
  echo "âŒ FSD architecture violations found"
  exit 1
}

# 6. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑĞµĞºÑ€ĞµÑ‚Ğ¾Ğ² (Secretlint) Ğ´Ğ»Ñ Ğ²ÑĞµĞ³Ğ¾ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°
echo "ğŸ” Checking for secrets (Secretlint)..."
npx secretlint "**/*.{ts,tsx,js,jsx,json}" --format json || {
  echo "âš ï¸  Potential secrets found"
  exit 1
}

echo "âœ… All frontend pre-commit checks passed!"

